<!DOCTYPE html>
<html lang="en">
<head>
    <title>
        <c:choose>
            <c:when test="${functionType == 'normalCheckList'}">
                任务列表
            </c:when>
            <c:when test="${functionType == 'conflictCheckList'}">
                冲突任务列表
            </c:when>
            <c:when test="${functionType == 'hostList'}">
                所有检测网站列表
            </c:when>
            <c:when test="${functionType == 'reportList'}">
                检测报表列表
            </c:when>
            <c:when test="${functionType == 'volunteerList'}">
                志愿者信息列表
            </c:when>
            <c:when test="${functionType == 'adminList'}">
                管理员信息列表
            </c:when>
            <c:when test="${functionType == 'keganzhixingStudyList'}">
                可感知性学习列表
            </c:when>
            <c:when test="${functionType == 'kecaozuoxingStudyList'}">
                可操作性学习列表
            </c:when>
            <c:when test="${functionType == 'kelijiexingStudyList'}">
                可理解性学习列表
            </c:when>
            <c:when test="${functionType == 'jianrongxingStudyList'}">
                兼容性学习列表
            </c:when>
        </c:choose>
    </title>

    <style>
        .hide-column{
            display: none;
        }
    </style>

    <%@include file="common/head.jsp" %>

</head>
<body>
<%@include file="common/navbar.jsp" %>

<div class="container">
    <%@include file="common/navbar_sub.jsp" %>
    <div class="row well">
        <!-- <legend>检测任务列表</legend> -->
        <div class="cus-center-container" style="margin-left:16px; margin-top: -47px;">
            <a href="javascript:void(0)" class="btn btn-primary btn-fab hide-a-effect"><i class="material-icons">bookmark</i>
                <div class="ripple-container"></div>
            </a>
            <a id="functionTitle" class="cus-center-content color-primary"
               style="padding-left: 16px; font-size: 28px;"
                    <c:choose>
                        <c:when test="${functionType == 'normalCheckList'}">
                            href="${AppContext}manual_task/list">任务列表
                        </c:when>
                        <c:when test="${functionType == 'conflictCheckList'}">
                            href="${AppContext}manual_task/conflict/list">冲突任务列表
                        </c:when>
                        <c:when test="${functionType == 'hostList'}">
                            href="${AppContext}host/list">检测网站列表
                        </c:when>
                        <c:when test="${functionType == 'reportList'}">
                            href="javascript:void(0)">检测报表列表
                        </c:when>
                        <c:when test="${functionType == 'volunteerList'}">
                            href="${AppContext}user/volunteer/list">志愿者信息列表
                        </c:when>
                        <c:when test="${functionType == 'adminList'}">
                            href="${AppContext}user/admin/list">管理员信息列表
                        </c:when>
                        <c:when test="${functionType == 'keganzhixingStudyList'}">
                            href="${AppContext}study/keganzhixing">可感知性学习列表
                        </c:when>
                        <c:when test="${functionType == 'kecaozuoxingStudyList'}">
                            href="${AppContext}study/kecaozuoxing">可操作性学习列表
                        </c:when>
                        <c:when test="${functionType == 'kelijiexingStudyList'}">
                            href="${AppContext}study/kelijiexing">可理解性学习列表
                        </c:when>
                        <c:when test="${functionType == 'jianrongxingStudyList'}">
                            href="${AppContext}study/jianrongxing">兼容性学习列表
                        </c:when>
                        <c:otherwise>
                            >
                        </c:otherwise>
                    </c:choose>
            </a>
        </div>

        <c:if test="${functionType == 'keganzhixingStudyList' || functionType == 'kecaozuoxingStudyList' ||
                functionType == 'kelijiexingStudyList' || functionType == 'jianrongxingStudyList'}">
            <div class="row" style="margin-top:-70px; margin-bottom: 25px;">
                <div class="col-md-3 col-md-offset-9" style="padding-right: 0;">
                    <div id="classification" class="form-group" style="margin-top: 0;">
                        <label for="ruleType" class="col-md-4 control-label" style="visibility: hidden;">选择规则</label>
                        <div class="col-md-8">
                            <select id="ruleType" class="form-control">
                                <c:forEach var="rule" items="${ruleList}">
                                    <option value="${rule.ruleId}">${rule.title}</option>
                                </c:forEach>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </c:if>

        <table id="aCentralTable" class="table table-striped table-hover ellipsis-table" style="margin-top: 10px;">
            <!-- 判断当前要显示哪个列表页面
                1. 普通网页检测
                2. 冲突网页检测
                3. 查看所有检测网站
                4. 查看检测报表
                5. 查看志愿者信息
                6. 查看管理员信息 -->
            <c:choose>
                <c:when test="${functionType == 'normalCheckList' || functionType == 'conflictCheckList'}">
                    <thead>
                    <tr>
                        <th>检测网站</th>
                        <th>检测开始时间</th>
                        <th>检测截止时间</th>
                        <th>我已检测数</th>
                        <th>剩余检测数</th>
                        <th>进入检测</th>
                    </tr>
                    </thead>
                    <%--<tbody>--%>
                    <%--<c:forEach var="hostInfo" items="${hostInfos}">--%>
                    <%--<tr>--%>
                    <%--<td><a href="${hostInfo.hostDomain}" title="${hostInfo.hostName}" target="_blank">${hostInfo.hostName}</a></td>--%>
                    <%--<td>--%>
                    <%--<fmt:formatDate value="${hostInfo.checkStartTime}" pattern="yyyy-MM-dd HH:mm:ss"/>--%>
                    <%--</td>--%>
                    <%--<td>--%>
                    <%--<fmt:formatDate value="${hostInfo.deadline}" pattern="yyyy-MM-dd HH:mm:ss"/>--%>
                    <%--</td>--%>
                    <%--<td>${hostInfo.userCheckedNum}</td>--%>
                    <%--<td>${hostInfo.leftNum}</td>--%>
                    <%--<td>--%>
                    <%--<c:choose>--%>
                    <%--<c:when test="${nowTime.getTime() > hostInfo.deadline.getTime() || hostInfo.leftNum <= 0}">--%>
                    <%--<span class="text-muted">任务结束</span>--%>
                    <%--</c:when>--%>
                    <%--<c:otherwise>--%>
                    <%--<c:choose>--%>
                    <%--<c:when test="${functionType == 'normalCheckList'}">--%>
                    <%--<a href="${AppContext}manual_task/${hostInfo.hostId}/task_detail">申请任务</a>--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${functionType == 'conflictCheckList'}">--%>
                    <%--<a href="${AppContext}manual_task/conflict/${hostInfo.hostId}/task_detail">申请任务</a>--%>
                    <%--</c:when>--%>
                    <%--</c:choose>--%>
                    <%--</c:otherwise>--%>
                    <%--</c:choose>--%>
                    <%--</td>--%>
                    <%--</tr>--%>
                    <%--</c:forEach>--%>
                    <%--</tbody>--%>
                </c:when>
                <c:when test="${functionType == 'hostList'}">
                    <thead>
                    <tr>
                        <th>检测网站</th>
                            <%--<th>申请单位</th>--%>
                        <th>申请时间</th>
                        <th>检测截止时间</th>
                        <th>网站状态</th>
                        <th>查看详情</th>
                        <th>申请复核</th>
                    </tr>
                    </thead>
                    <%--<tbody>--%>
                    <%--<c:forEach var="host" items="${hosts}">--%>
                    <%--<tr>--%>
                    <%--<td><a href="${host.hostDomain}" title="${host.hostName}" target="_blank">${host.hostName}</a></td>--%>
                    <%--<td title="${host.applicant}">${host.applicant}</td>--%>
                    <%--<td>--%>
                    <%--<fmt:formatDate value="${host.createTime}" pattern="yyyy-MM-dd HH:mm:ss"/>--%>
                    <%--</td>--%>
                    <%--<td>--%>
                    <%--<fmt:formatDate value="${host.deadline}" pattern="yyyy-MM-dd HH:mm:ss"/>--%>
                    <%--</td>--%>
                    <%--<td>--%>
                    <%--<c:choose>--%>
                    <%--<c:when test="${host.state == 0}">--%>
                    <%--准备爬虫--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 1}">--%>
                    <%--正在爬虫--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 2}">--%>
                    <%--爬虫暂停--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 3}">--%>
                    <%--正在打标签--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 4}">--%>
                    <%--正在自动检测--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 5}">--%>
                    <%--正在人工检测--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 6}">--%>
                    <%--正在统计结果--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${host.state == 7}">--%>
                    <%--检测结束--%>
                    <%--</c:when>--%>
                    <%--<c:otherwise>--%>
                    <%--还有谁--%>
                    <%--</c:otherwise>--%>
                    <%--</c:choose>--%>
                    <%--</td>--%>
                    <%--<td>--%>
                    <%--<a href="${AppContext}host/${host.hostId}">查看详情</a>--%>
                    <%--</td>--%>
                    <%--</tr>--%>
                    <%--</c:forEach>--%>
                    <%--</tbody>--%>
                </c:when>
                <c:when test="${functionType == 'volunteerList' || functionType == 'adminList'}">
                    <thead>
                    <tr>
                        <th>昵称</th>
                        <th>邮箱号</th>
                        <th>手机号</th>
                        <th>注册时间</th>
                        <th>禁用/激活账号</th>
                        <th>联系他/她</th>
                            <%--<th>上次登录</th>--%>
                            <%--<th>完成总任务数</th>--%>
                            <%--<th>积分</th><!--用户等级？-->--%>
                            <%--<th>账号状态</th>--%>
                            <%--<th>高级志愿者</th>--%>
                    </tr>
                    </thead>
                    <%--<tbody>--%>
                    <%--<c:forEach var="user" items="${users}">--%>
                    <%--<tr>--%>
                    <%--<td title="${user.userName}">${user.nickname}</td><!--可以增加用户空间的链接-->--%>
                    <%--<td title="${user.emailNum}">${user.emailNum}</td>--%>
                    <%--<td>${user.phoneNum}</td>--%>
                    <%--<td>--%>
                    <%--<fmt:formatDate value="${user.createTime}" pattern="yyyy-MM-dd HH:mm:ss"/>--%>
                    <%--</td>--%>
                    <%--&lt;%&ndash;<td>&ndash;%&gt;--%>
                    <%--&lt;%&ndash;<fmt:formatDate value="${item.lastLoginTime}" pattern="yyyy-MM-dd HH:mm:ss"/>&ndash;%&gt;--%>
                    <%--&lt;%&ndash;</td>&ndash;%&gt;--%>
                    <%--&lt;%&ndash;<td>${item.taskNum}</td>&ndash;%&gt;--%>
                    <%--&lt;%&ndash;<td>${item.score}</td>&ndash;%&gt;--%>
                    <%--<td>--%>
                    <%--<c:choose>--%>
                    <%--<c:when test="${user.state == 0}">--%>
                    <%--在线--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${user.state == 1}">--%>
                    <%--离线--%>
                    <%--</c:when>--%>
                    <%--<c:when test="${user.state == 2}">--%>
                    <%--任务中--%>
                    <%--</c:when>--%>
                    <%--<c:otherwise>--%>
                    <%--还有谁--%>
                    <%--</c:otherwise>--%>
                    <%--</c:choose>--%>
                    <%--</td>--%>
                    <%--<c:choose>--%>
                    <%--<c:when test="${user.accountState == 0}">--%>
                    <%--&lt;%&ndash;<td>正常</td>&ndash;%&gt;--%>
                    <%--<td><a href="javascript:void(0)" class="btn-forbid-account" onclick="forbidAccount('${user.userName}', '${AppContext}user/${user.userId}/forbid_account')">禁用</a></td>--%>
                    <%--</c:when>--%>
                    <%--<c:otherwise>--%>
                    <%--&lt;%&ndash;<td>禁用</td>&ndash;%&gt;--%>
                    <%--<td><a href="javascript:void(0)" class="btn-enable-account" onclick="enableAccount('${user.userName}', '${AppContext}user/${user.userId}/enable_account')">恢复</a></td>--%>
                    <%--</c:otherwise>--%>
                    <%--</c:choose>--%>
                    <%--<td><a href="${AppContext}message/send/${user.userId}">发送消息</a></td>--%>
                    <%--&lt;%&ndash;<td><a href="#">变身</a></td>&ndash;%&gt;--%>
                    <%--</tr>--%>
                    <%--</c:forEach>--%>
                    <%--</tbody>--%>
                </c:when>
                <c:when test="${functionType == 'keganzhixingStudyList' || functionType == 'kecaozuoxingStudyList' ||
                functionType == 'kelijiexingStudyList' || functionType == 'jianrongxingStudyList'}">
                    <thead>
                    <tr>
                        <th>学习网页</th>
                        <th>所属网站</th>
                        <th>具体规则</th>
                        <th>进入学习</th>
                    </tr>
                    </thead>
                </c:when>
                <c:otherwise>
                    不科学
                </c:otherwise>
            </c:choose>
        </table>
    </div>
</div>

<%@include file="common/footer.jsp" %>

<script type="text/javascript">

    var doUserUrl = null;//传给doUser的参数，设为全局变量
    $(function () {
        //datables初始化
        var columns = null;//根据不同类型的表设定不同的表头变量
        var columnDefs = null;//自定义列
        var order = null;//自定义初始排序列
        if(${functionType == 'normalCheckList' || functionType == 'conflictCheckList'}) {
            order = [2, 'asc'];//检测开始时间升序

            columns = [
                { "data": "hostName" },
                { "data": "checkStartTime" },
                { "data": "deadline" },
                { "data": "userCheckedNum" },
                { "data": "leftNum" },
                { "data": "" }//进入检测按钮列
            ];

            columnDefs = [
                {
                    "targets": 0,
                    "render": function (data, type, row, meta) {
                        return "<a href=\""+ row.hostDomain +"\" title=\"" + data +"\" target=\"_blank\">" + data +"</a>";
                    }
                },
                {
                    "targets": [1, 2],
                    "render": function (data, type, row, meta) {
                        return moment(data).format('YYYY-MM-DD HH:mm:ss');
                    }
                },
                {
                    "targets": [-2, -3],
                    "orderable": false
                },
                {
                    "targets": -1,
                    "orderable": false,
                    "render": function (data, type, row, meta) {
                        var currentDate = new Date();
                        var theDeadline = new Date(row.deadline);
                        if(currentDate.getTime() > theDeadline.getTime() || row.leftNum <= 0) {
                            return "<span class=\"text-muted\">任务结束</span>";
                        } else {
                            if(${functionType == 'normalCheckList'}) {
                                return "<a href=\"${AppContext}manual_task/" + row.hostId + "/task_detail\">申请任务</a>";
                            } else if(${functionType == 'conflictCheckList'}) {
                                return "<a href=\"${AppContext}manual_task/conflict/" + row.hostId + "/task_detail\">申请任务</a>";
                            }
                        }
                    }
                }
            ];
        } else if(${functionType == 'volunteerList' || functionType == 'adminList'}) {
            order = [3, 'desc'];//注册时间降序

            columns = [
//            {"data": "userId"},
                { "data": "nickname" },
                { "data": "emailNum" },
                { "data": "phoneNum" },
                { "data": "registerTime" },
                { "data": "" },//禁用/激活账号按钮列
                { "data": "" }//发送消息按钮列
            ];

            columnDefs = [
                {
                    "targets": 0,
                    "render": function (data, type, row, meta) {
                        return "<a href=\"${AppContext}zone/yard/" + row.userId + "\" title=\"" + data + "\">" + data + "</a>";
                    }
                },
                {
                    "targets": 1,
                    "render": function (data, type, row, meta) {
                        return "<a href=\"mailto:" + data + "\" title=\"" + data + "\">" + data + "</a>";
                    }
                },
                {
                    "targets": 2,
                    "render": function (data, type, row, meta) {
                        if(data == "" || data == null) {
                            return "暂无";
                        } else {
                            return data;
                        }
                    }
                },
                {
                    "targets": -3,
                    "render": function (data, type, full, meta) {
                        return moment(data).format('YYYY-MM-DD HH:mm:ss');
                    }
                },
                {
                    "targets": -2,
                    "orderable": false,
                    "render": function (data, type, row, meta) {
                        console.log(row.accountState);
                        if(row.accountState == 0) {//账号正常
                            return "<a href=\"javascript:void(0)\" onclick=\"forbidAccount('" + row.userName +
                                "', '${AppContext}user/" + row.userId + "/forbid_account')\">禁用</a>";
                        } else if(row.accountState == 1) {//账号禁用
                            return "<a href=\"javascript:void(0)\" onclick=\"enableAccount('" + row.userName +
                                "', '${AppContext}user/" + row.userId + "/enable_account')\">恢复</a>";
                        }
                    }
                },
                {
                    "targets": -1,
                    "orderable": false,
                    "render":function (data, type, row, meta) {
                        return "<a href=\"${AppContext}message/send/" + row.userId + "\">发送消息</a>";
                    }
                }
            ];
        } else if(${functionType == 'hostList'}) {
            order = [3, 'desc'];//申请时间降序

            columns = [
                {"data": "hostName"},
                {"data": "createTime"},
                {"data": "deadline"},
                {"data": "stateInfo"},
                {"data":""},
//                {"data": ""},
                {"data":""}
            ];

            columnDefs = [
                {
                    "targets": 0,
                    "render": function (data, type, row, meta) {
                        return "<a href=\""+ row.hostDomain +"\" title=\"" + data +"\" target=\"_blank\">" + data +"</a>";
                    }
                },
                {
                    "targets": [1, 2],
                    "render": function (data, type, row, meta) {
                        return moment(data).format("YYYY-MM-DD HH:mm:ss");
                    }
                },
                {
                    "targets": -1,
                    "orderable": false,
                    "render": function(data, type, row, meta) {
//
                        return "<a href=\"javascript:void(0)\" onclick=\"doReview(" + row.hostId + ")\">复核</a>";

                    }
                },
//                {
//                    "targets": -2,
//                    "orderable": false,
//                    "render": function(data, type, row, meta) {
//                        return "<a href=\"javascript:void(0)\" onclick=\"doSynSingleHost(" + row.hostId + ")\">同步网页</a>";
//                    }
//                },
                {
                    "targets": -2,
                    "orderable": false,
                    "render": function(data, type, row, meta) {
                        return "<a href=\"${AppContext}host/" + row.hostId + "\">查看详情</a>";
                    }
                },
                {
                    "targets": -3,
                    "render": function(data, type, row, meta) {
                        if(row.state == 8) {//报表已生成
                            return "<a href=\"javascript:void(0)\" onclick=\"downloadReport(" + row.hostId + ")\">下载报告</a>";
                        } else {
                            return data;
                        }
                    }
                }
            ]
        } else if(${functionType == 'keganzhixingStudyList' || functionType == 'kecaozuoxingStudyList' ||
                functionType == 'kelijiexingStudyList' || functionType == 'jianrongxingStudyList'}) {
            $('#studyModel').addClass('active');

            order = [2, 'asc'];//规则名称升序

//            {"data" : "pageTitle"},
//            {"data" : "hostName"},
//            {"data" : "ruleTitle"},
            columns = [
                {"data" : "pageTitle"},
                {"data" : "hostName"},
                {"data" : "ruleId"},
                {"data" : ""}//进入学习
            ];

            columnDefs = [
                {
                    "targets" : 0,
                    "render" : function(data, type, row, meta) {
                        if(data == "") {
                            return "<a target=\"_blank\" href=\"" + row.pageUrl + "\" title=\"该网页没有标题\">该网页没有标题</a>";
//                            return "<a target=\"_blank\" href=\"" + data + "\" title=\"该网页没有标题\">该网页没有标题</a>";
                        } else {
//                            return "<a target=\"_blank\" href=\"" + data + "\" title=\"" + data + "\">" + data + "</a>";
                            return "<a target=\"_blank\" href=\"" + row.pageUrl + "\" title=\"" + data + "\">" + data + "</a>";
                        }
                    }
                },
                {
                    "targets" : 1,
                    "render" : function(data, type, row, meta) {
//                        return "<a href=\""+ data +"\" title=\"" + data +"\" target=\"_blank\">" + data +"</a>";
                        return "<a href=\""+ row.hostDomain +"\" title=\"" + data +"\" target=\"_blank\">" + data +"</a>";
                    }
                },
                {
                    "targets" : 2,
                    className : "hide-column",
                    "render" : function (data, type, row, meta) {
                        return "<span title=\"" + data + "\">" + data + "</span>";
                    }
                },
                {
                    "targets" : -1,
                    "orderable": false,
                    "render" : function(data, type, row, meta) {
                        return "<a href=\"${AppContext}study/" + row.studyItemId + "\">进入学习</a>";
                    }
                }
            ]
        }

        //init a datatable
        $("#aCentralTable").DataTable({
            "language": {
                "url": "${AppContext}resources/lang/datatables_zhcn.json"
            },
            "pagingType": "full_numbers",
            "order": order,
            //配置列要显示的数据
            "columns": columns,
            //自定义列
            "columnDefs": columnDefs,
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": "${AppContext}datatables",
                "data": function(data) {
                    //add extra data
                    if(${functionType == 'normalCheckList'}) {
                        data.dataTableType = "normalCheckList";
                    } else if(${functionType == 'conflictCheckList'}) {
                        data.dataTableType = "conflictCheckList";
                    } else if(${functionType == 'volunteerList'}) {
                        data.dataTableType = "volunteerList";
                    } else if(${functionType == 'adminList'}) {
                        data.dataTableType = "adminList";
                    } else if(${functionType == "hostList"}) {
                        data.dataTableType = "hostList";
                        //需要将stateInfo的列名改为state，用于排序
                        data.columns[3].data = "state";
                    } else if(${functionType == 'keganzhixingStudyList' || functionType == 'kecaozuoxingStudyList'
                    || functionType == 'kelijiexingStudyList' || functionType == 'jianrongxingStudyList'}) {
                        //需要将studyItemInfo的pageTitle列名改为title
                        data.columns[0].data = "title";
                        data.dataTableType = "studyList&"+$('#ruleType').val();
                    }
                    //deal with the datatable data
                    planify(data);
                }
            },
            "initComplete": function(setting, json) {
                // customize datatables
                //$('#aCentralTable_length').addClass('form-group');
                $('select.form-control').removeClass('input-sm');
                $('#aCentralTable_filter').addClass('form-group pull-right');
                $('#aCentralTable_paginate').addClass('pull-right');
                $('#classification').removeClass('form-group');
            }
        });

        //确认禁用/恢复
        $('#modalSubBtn').click(function() {
            doUser(doUserUrl);
        });
    });

    //处理datatables数据
    function planify(data) {
        var column;//对datatables某些特殊列（三维列）进行处理
        for (var i = 0; i < data.columns.length; i++) {
            column = data.columns[i];
            column.searchRegex = column.search.regex;
            column.searchValue = column.search.value;
            delete(column.search);
        }
    }

    $("#ruleType").change(function() {
        $("#aCentralTable").DataTable().draw();
    });

    var forbidAccount = function (userName, url) {
        doUserUrl = url;
        showModalWithSubBtn("友情提示", "确定要禁用用户 "+userName, '确定禁用', '');
    };

    var enableAccount = function (userName, url) {
        doUserUrl = url;
        showModalWithSubBtn("友情提示", "确定要恢复用户 "+userName, '确定恢复', '');
    };

    var doUser = function(url) {
        $.ajax({
            type : 'POST',
            url : url,
            success : function (result) {
                if(result.resultStatus == "FAIL") {
                    showModal("错误提示", result.resultMsg, '');
                } else if(result.resultStatus == "SUCCESS") {
                    showModal("友情提示", result.resultMsg, '');
                    $('#modalCommon').on('hidden.bs.modal', function () {
                        if (${functionType == 'volunteerList'}) {
                            window.location = '${AppContext}user/volunteer/list';
                        } else {
                            window.location = '${AppContext}user/admin/list';
                        }
                    });
                }
            }
        });
    };

    var downloadReport = function (hostId) {
        $.ajax({
            type : "POST",
            url : "${AppContext}report/validate/"+hostId,
            success : function (result) {
                if(result.resultStatus == "FAIL") {
                    showModal("错误提示", result.resultMsg, '');
                    $("#modalCommon").on("hidden.bs.modal", function () {
                        //下载报告出错，尝试刷新页面
                        window.location = "${AppContext}host/list";
                    })
                } else if(result.resultStatus == "SUCCESS") {
                    //文件验证成功，直接下载
                    window.location = "${AppContext}report/download/"+hostId;
                }
            }
        });
    }

    //在hostlist中申请复核功能
    var doReview = function (hostId) {
        $.ajax({
            type : "POST",
            url  : "${AppContext}conflict/addconflict",
            data : JSON.stringify(hostId),
            success :function(result) {
                if(result == 1){
                    alert("申请复核成功！");
                }
            }
        });
    }
    //在hostlist中申请同步网页items
    var doSynSingleHost = function (hostId) {
        $.ajax({
            type : "POST",
            url : "${AppContext}host/SynSingleHost",
            data : JSON.stringify(hostId),
            success : function (result) {
                if(result==1){
                    alert("同步成功");
                }
            }
        });
    }
</script>
</body>
</html>
